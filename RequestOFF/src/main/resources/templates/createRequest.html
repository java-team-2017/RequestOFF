<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Header</title>
		<link rel="stylesheet" type="text/css" href="css/layoutStyle.css" />
		<link rel="stylesheet" type="text/css" href="css/common.css" />
		<link rel="stylesheet"	type="text/css" href="css/bootstrap.min.css" />
		<link rel="stylesheet"	type="text/css" href="css/notify.css" />
		<link rel="stylesheet" type="text/css" href="css/datatables.min.css"/>
		<script src="javascript/jquery-3.2.1.js"></script>
		<script src="javascript/bootstrap.min.js"></script>
		<script src="javascript/jquery.serializejson.js"></script>
		<script src="javascript/common.js"></script>
		<script src="javascript/notify.js"></script>
		<script type="text/javascript" src="javascript/datatables.min.js"></script>
		<script type="text/javascript" src="javascript/bootstrap-confirmation.min.js"></script>
	</head>
	<body  class="content-body">
		<script>
		/*<![CDATA[*/
			$(function() {
				renderRemainHours(employeeId, 'remainHours');
				renderDayOffTypeSelect('id_dayOffType');
				
				//recipient select box
				$.ajax({
					type : "POST",
					contentType : "application/json",
					url : "/employee/details",
					dataType : 'json',
					data : JSON.stringify({ "id" : employeeId }),
					success : function(returnData) {
						var temp;
						if(returnData.employee.position.name == "leader") {
							listRecipient.push(returnData.employee.team.department.manager);
						}
						else {
							listRecipient.push(returnData.employee.listTeam[0].leader);
							listRecipient.push(returnData.employee.listTeam[0].department.manager);
						}
						var option = "";
						$.each(listRecipient, function(i, element){
							option += "<option value='" + element.name + "'>" + element.name + "</option>"; 
						});
						$("#id_recipient").append(option);
					},
					error : function(e) {
						console.log("ERROR: ", e);
					}
				});
				
				$('#btnSave, #btnSend').on('click', function() {
					var status, alertStr;
					if( $(this).attr('id') == 'btnSave' ) {
						status = 1;
						alertStr = "Your request has been saved";
					}
					else {
						status = 5;
						alertStr = "Your request has been sent";
					}
					var createRequestData = $('#createRequestForm').serializeJSON();
					if(validate("#createRequestForm") == 1) {
						requestRegistRequest = {
							"id" : "",
							"employee_id" : employeeId,
							"from_time" : createRequestData.from,
							"to_time" : createRequestData.to,
							"reason" : createRequestData.reason,
							"status" : status,
							"response_message" : "",
							"day_off_type_id" : getDayOffTypeId(listDayOffType, createRequestData.dayOffType),
							"recipient_id" : getRecipientNameOrId(listRecipient, createRequestData.recipient),
							"valid_flag" : "1",
							"update_date" : ""
						}
						console.log(requestRegistRequest);
						$.ajax({
							type : "POST",
							contentType : "application/json",
							url : "/request/regist",
							dataType : 'json',
							data : JSON.stringify(requestRegistRequest),
							success : function(returnData) {
							},
							error : function(e) {
								console.log("ERROR: ", e);
							}
						});
						
						$("#createRequestForm :input").not("button, select").val("");
						$("#createRequestForm select").prop('selectedIndex', 0);
						alert(alertStr);
					}
				});
			});
		
			var employeeId = "1";
			var listRecipient = [];
			var listDayOffType;
			
			function validate(formId) {
				var ok = 1;
				var listInput = $(formId).find(':input').not("button");
				$.each(listInput, function() {
					if($(this).val() == "") {
						ok = 0;
					}
// 					if($("#id_to").val() )
				});
				if(ok == 0) {
					alert(errors.incompleteFields);
				}
				return ok;
			}
				
		/*]]>*/
		</script>

		<div>
			<div th:replace="fragments/header"></div>
			<div th:replace="menu"></div>

			<div class="requestOffContentBody">
				<h2>Create Request</h2>
				<div>
					<h4>Bạn còn <span id="remainHours"></span> ngày nghỉ phép</h4>
					<form id="createRequestForm" class="form-input">
						<div class="form-group">
							<label>From: </label>
							<input type="datetime-local" class="form-control" name="from" id="id_from"/>
						</div>
						<div class="form-group">
							<label>To: </label>
							<input type="datetime-local" class="form-control" name="to" id="id_to"/>
						</div>
						<div class="form-group">
							<label>Reason: </label>
							<textarea class="form-control" name="reason" id="id_reason"></textarea>
						</div>
						<div class="form-group">
							<label>Day off type: </label>
							<select class="form-control" name="dayOffType" id="id_dayOffType">
							</select>
						</div>
						<div class="form-group">
							<label>Send to: </label>
							<select class="form-control" name="recipient" id="id_recipient">
							</select>
						</div>
						<br/>
						<div>
							<button type="button" class="btn btn-primary createRequestFormButton" id="btnSave">Save</button>
							<button type="button" class="btn btn-primary createRequestFormButton" id="btnSend">Send</button>
							<button type="button" class="btn btn-primary createRequestFormButton" id="btnCancel">Cancel</button>
						</div>
					</form>
				</div>
			</div>
			<div th:replace="fragments/footer"></div>
		</div>

	</body>
</html>